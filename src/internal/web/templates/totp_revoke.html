<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Unbind TOTP - {{.Title}}</title>
  <link rel="icon" href="/favicon.ico" sizes="any" />
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0;}
    body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:#f3f4f6;color:#111827;line-height:1.5;min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px;}
    .card{background:#fff;border-radius:16px;box-shadow:0 20px 50px rgba(0,0,0,0.1);max-width:420px;width:100%;overflow:hidden;}
    .content{padding:32px;}
    h1{font-size:1.5rem;margin-bottom:8px;}
    .subtitle{color:#6b7280;font-size:0.875rem;margin-bottom:24px;}
    .btn{width:100%;padding:14px;font-size:1rem;font-weight:600;color:#fff;background:#111827;border:none;border-radius:12px;cursor:pointer;}
    .btn:hover{background:#000;}
    .btn-secondary{background:#6b7280;}
    .btn-secondary:hover{background:#4b5563;}
    .btn-danger{background:#dc2626;}
    .btn-danger:hover{background:#b91c1c;}
    .actions{display:flex;gap:12px;margin-top:24px;}
    .actions .btn{flex:1;}
    .error{background:#fef2f2;border:1px solid #fecaca;border-radius:12px;padding:12px;margin-bottom:16px;display:none;}
    .error.show{display:block;color:#dc2626;}
    .success{background:#f0fdf4;border:1px solid #86efac;border-radius:12px;padding:12px;margin-bottom:16px;display:none;}
    .success.show{display:block;color:#166534;}
    .footer{margin-top:24px;text-align:center;font-size:0.875rem;color:#6b7280;}
    .footer a{color:#111827;}
  </style>
</head>
<body>
  <main class="card">
    <div class="content">
      <h1>Unbind Authenticator (TOTP)</h1>
      <p class="subtitle">This will remove TOTP and backup codes for your account. You can bind again later at /totp/enroll.</p>
      <div id="error" class="error"></div>
      <div id="success" class="success">TOTP has been unbound. <a href="/">Back to home</a></div>
      <form id="revokeForm" method="post" action="/totp/revoke">
        <div class="actions">
          <button type="button" class="btn btn-secondary" id="btnCancel">Cancel</button>
          <button type="submit" class="btn btn-danger" id="btnRevoke">Unbind TOTP</button>
        </div>
      </form>
      <p class="footer"><a href="/totp/enroll">Bind TOTP</a> Â· <a href="/">Back to home</a></p>
    </div>
  </main>
  <script>
    (function() {
      document.getElementById('btnCancel').addEventListener('click', function() { window.location.href = '/'; });
      document.getElementById('revokeForm').addEventListener('submit', function(e) {
        e.preventDefault();
        var form = e.target;
        var errEl = document.getElementById('error');
        var successEl = document.getElementById('success');
        errEl.classList.remove('show');
        successEl.classList.remove('show');
        fetch(form.action, { method: 'POST', credentials: 'same-origin' })
          .then(function(r) { return r.json().then(function(j){ return { ok: r.ok, json: j }; }); })
          .then(function(res) {
            if (res.ok && res.json.ok) {
              form.style.display = 'none';
              successEl.classList.add('show');
            } else {
              errEl.textContent = res.json.error || 'Unbind failed';
              errEl.classList.add('show');
            }
          })
          .catch(function(err) {
            errEl.textContent = err.message || 'Request failed';
            errEl.classList.add('show');
          });
      });
    })();
  </script>
</body>
</html>
